"use strict";(self.webpackChunkbru_finance=self.webpackChunkbru_finance||[]).push([[1832],{93300:(e,t,i)=>{i.d(t,{y:()=>r});var a=i(97779),n=i(3340);function r(e){const t=e.domain;return void 0!==(null===t||void 0===t?void 0:t.chainId)&&(0,a.q)(t.chainId)&&(e.domain={...e.domain,chainId:(0,n.ME)(e.domain.chainId)}),e}},1832:(e,t,i)=>{i.d(t,{InAppWebConnector:()=>O});var a=i(18342),n=i(51739),r=i(79039),o=i(387),s=i(47005);function l(e){return new Promise((t=>{setTimeout(t,1e3*e)}))}const c={height:"100%",width:"100%",border:"none",backgroundColor:"transparent",colorScheme:"light",position:"fixed",top:"0px",right:"0px",zIndex:"2147483646",display:"none"},d=new Map;class u{constructor(e){let{link:t,baseUrl:i,iframeId:a,container:n=document.body,onIframeInitialize:r}=e;Object.defineProperty(this,"iframe",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"POLLING_INTERVAL_SECONDS",{enumerable:!0,configurable:!0,writable:!0,value:1.4}),Object.defineProperty(this,"iframeBaseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.iframeBaseUrl=i;let o=document.getElementById(a);const s=new URL(t);if(!o||o.src!==s.href){if(!o){o=document.createElement("iframe");const e={...c};Object.assign(o.style,e),o.setAttribute("id",a),o.setAttribute("fetchpriority","high"),n.appendChild(o)}o.src=s.href;const e=t=>{if("ewsIframeLoaded"===t.data.eventType){if(window.removeEventListener("message",e),!o)return void console.warn("thirdweb Iframe not found");this.onIframeLoadHandler(o,r)()}};window.addEventListener("message",e)}this.iframe=o}async onIframeLoadedInitVariables(){return{}}onIframeLoadHandler(e,t){return async()=>{var i;const a=new MessageChannel,n=new Promise(((i,n)=>{a.port1.onmessage=r=>{const{data:o}=r;a.port1.close(),o.success||n(new Error(o.error)),d.set(e.src,!0),t&&t(),i(!0)}}));null===e||void 0===e||null===(i=e.contentWindow)||void 0===i||i.postMessage({eventType:"initIframe",data:await this.onIframeLoadedInitVariables()},this.iframeBaseUrl,[a.port2]),await n}}async call(e){var t;let{procedureName:i,params:a,showIframe:n=!1}=e;for(;!d.get(this.iframe.src);)await l(this.POLLING_INTERVAL_SECONDS);n&&(this.iframe.style.display="block",await l(.005));const r=new MessageChannel,o=new Promise(((e,t)=>{r.port1.onmessage=async i=>{const{data:a}=i;r.port1.close(),n&&(await l(.1),this.iframe.style.display="none"),a.success?e(a.data):t(new Error(a.error))}}));return null===(t=this.iframe.contentWindow)||void 0===t||t.postMessage({eventType:i,data:a},this.iframeBaseUrl,[r.port2]),o}destroy(){d.delete(this.iframe.src)}}class h extends u{constructor(e){let{clientId:t,baseUrl:i}=e;super({iframeId:g,link:p({clientId:t,path:o.CW,baseUrl:i}).href,baseUrl:i,container:document.body}),Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.clientId=t}async onIframeLoadedInitVariables(){const e=new s.D({clientId:this.clientId});return{authCookie:await e.getAuthCookie(),deviceShareStored:await e.getDeviceShare(),walletUserId:await e.getWalletUserId(),clientId:this.clientId}}}function p(e){let{clientId:t,baseUrl:i,path:a,queryParams:n}=e;const r=new URL("".concat(a),i);if(n)for(const s of Object.keys(n)){var o;r.searchParams.set(s,(null===(o=n[s])||void 0===o?void 0:o.toString())||"")}return r.searchParams.set("clientId",t),r}const g="thirdweb-in-app-wallet-iframe";class m{constructor(e){let{baseUrl:t,querier:i,preLogin:a,postLogin:n,client:r}=e;Object.defineProperty(this,"LoginQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"preLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseUrl=t,this.LoginQuerier=i,this.preLogin=a,this.postLogin=n,this.client=r}async sendEmailLoginOtp(e){let{email:t}=e;await this.preLogin();return await this.LoginQuerier.call({procedureName:"sendThirdwebEmailLoginOtp",params:{email:t}})}async sendSmsLoginOtp(e){let{phoneNumber:t}=e;await this.preLogin();return await this.LoginQuerier.call({procedureName:"sendThirdwebSmsLoginOtp",params:{phoneNumber:t}})}}class w extends m{constructor(){super(...arguments),Object.defineProperty(this,"closeWindow",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let{isWindowOpenedByFn:t,win:i,closeOpenedWindow:a}=e;t?null===i||void 0===i||i.close():i&&a?a(i):i&&i.close()}})}async getOauthLoginUrl(e){return await this.LoginQuerier.call({procedureName:"getHeadlessOauthLoginLink",params:{authProvider:e}})}async loginWithModal(){await this.preLogin();const e=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:void 0,showIframe:!0});return this.postLogin(e)}async loginWithEmailOtp(e){let{email:t}=e;await this.preLogin();const i=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:{email:t},showIframe:!0});return this.postLogin(i)}getOauthPopUpSizing(e){return e===r.OJ.FACEBOOK?"width=715, height=555":"width=350, height=500"}async loginWithOauth(e){let t=null===e||void 0===e?void 0:e.openedWindow,i=!1;if(t||(t=window.open("","Login",this.getOauthPopUpSizing(e.oauthProvider)),i=!0),!t)throw new Error("Something went wrong opening pop-up");const[{loginLink:a}]=await Promise.all([this.getOauthLoginUrl(e.oauthProvider),this.preLogin()]);t.location.href=a;const n=await new Promise(((a,n)=>{const r=window.setInterval((async()=>{t&&t.closed&&(clearInterval(r),window.removeEventListener("message",o),n(new Error("User closed login window")))}),1e3),o=async s=>{if(s.origin===this.baseUrl)if("object"===typeof s.data)switch(s.data.eventType){case"userLoginSuccess":window.removeEventListener("message",o),clearInterval(r),this.closeWindow({isWindowOpenedByFn:i,win:t,closeOpenedWindow:null===e||void 0===e?void 0:e.closeOpenedWindow}),s.data.authResult&&a(s.data.authResult);break;case"userLoginFailed":window.removeEventListener("message",o),clearInterval(r),this.closeWindow({isWindowOpenedByFn:i,win:t,closeOpenedWindow:null===e||void 0===e?void 0:e.closeOpenedWindow}),n(new Error(s.data.error));break;case"injectDeveloperClientId":var l;null===(l=t)||void 0===l||l.postMessage({eventType:"injectDeveloperClientIdResult",developerClientId:this.client.clientId,authOption:e.oauthProvider},this.baseUrl)}else n(new Error("Invalid event data"))};window.addEventListener("message",o)}));return this.postLogin({storedToken:{...n.storedToken,shouldStoreCookieString:!0},walletDetails:{...n.walletDetails,isIframeStorageEnabled:!1}})}async loginWithCustomJwt(e){let{encryptionKey:t,jwt:i}=e;await this.preLogin();const a=await this.LoginQuerier.call({procedureName:"loginWithCustomJwt",params:{encryptionKey:t,jwt:i}});return this.postLogin(a)}async loginWithCustomAuthEndpoint(e){let{encryptionKey:t,payload:i}=e;await this.preLogin();const a=await this.LoginQuerier.call({procedureName:"loginWithCustomAuthEndpoint",params:{encryptionKey:t,payload:i}});return this.postLogin(a)}async verifyEmailLoginOtp(e){let{email:t,otp:i,recoveryCode:a}=e;const n=await this.LoginQuerier.call({procedureName:"verifyThirdwebEmailLoginOtp",params:{email:t,otp:i,recoveryCode:a}});return this.postLogin(n)}async verifySmsLoginOtp(e){let{phoneNumber:t,otp:i,recoveryCode:a}=e;const n=await this.LoginQuerier.call({procedureName:"verifyThirdwebSmsLoginOtp",params:{phoneNumber:t,otp:i,recoveryCode:a}});return this.postLogin(n)}}class y{constructor(e){let{client:t,querier:i,onAuthSuccess:a,baseUrl:n}=e;Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"AuthQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAuthSuccess",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BaseLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t,this.AuthQuerier=i,this.localStorage=new s.D({clientId:t.clientId}),this.onAuthSuccess=a,this.BaseLogin=new w({postLogin:async e=>this.postLogin(e),preLogin:async()=>{await this.preLogin()},querier:i,client:t,baseUrl:n})}async preLogin(){await this.logout()}async postLogin(e){let{storedToken:t,walletDetails:i}=e;t.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(t.cookieString);return await this.onAuthSuccess({storedToken:t,walletDetails:i})}async loginWithAuthToken(e,t){await this.preLogin();const i=await this.AuthQuerier.call({procedureName:"loginWithStoredTokenDetails",params:{storedToken:e.storedToken,recoveryCode:t}});return this.postLogin(i)}async loginWithModal(){return this.BaseLogin.loginWithModal()}async loginWithEmailOtp(e){return this.BaseLogin.loginWithEmailOtp(e)}async loginWithCustomJwt(e){return this.BaseLogin.loginWithCustomJwt(e)}async loginWithCustomAuthEndpoint(e){return this.BaseLogin.loginWithCustomAuthEndpoint(e)}async loginWithOauth(e){return this.BaseLogin.loginWithOauth(e)}async sendEmailLoginOtp(e){let{email:t}=e;return this.BaseLogin.sendEmailLoginOtp({email:t})}async sendSmsLoginOtp(e){let{phoneNumber:t}=e;return this.BaseLogin.sendSmsLoginOtp({phoneNumber:t})}async verifyEmailLoginOtp(e){return this.BaseLogin.verifyEmailLoginOtp(e)}async verifySmsLoginOtp(e){return this.BaseLogin.verifySmsLoginOtp(e)}async logout(){const{success:e}=await this.AuthQuerier.call({procedureName:"logout",params:void 0}),t=await this.localStorage.removeAuthCookie(),i=await this.localStorage.removeWalletUserId();return{success:e||t||i}}}var b=i(37629),v=i(9893);var f=i(72364),L=i(93300);class I{constructor(e){let{client:t,querier:i}=e;Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"walletManagerQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=t,this.walletManagerQuerier=i,this.localStorage=new s.D({clientId:t.clientId})}async postWalletSetUp(e){let{deviceShareStored:t,walletAddress:i,isIframeStorageEnabled:a,walletUserId:n}=e;return a||await this.localStorage.saveDeviceShare(t,n),{walletAddress:i}}async getUserWalletStatus(){const e=await this.walletManagerQuerier.call({procedureName:"getUserStatus",params:void 0});return e.status===r.P1.LOGGED_IN_WALLET_INITIALIZED?{status:r.P1.LOGGED_IN_WALLET_INITIALIZED,...e.user,account:await this.getAccount()}:e.status===r.P1.LOGGED_IN_NEW_DEVICE||e.status===r.P1.LOGGED_IN_WALLET_UNINITIALIZED?{status:r.P1.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:{status:e.status}}async getAccount(){const e=this.walletManagerQuerier,{address:t}=await e.call({procedureName:"getAddress",params:void 0}),i=async t=>{var i;const a={to:null!==(i=t.to)&&void 0!==i?i:void 0,data:t.data,value:t.value,gasLimit:t.gas,nonce:t.nonce,chainId:t.chainId};t.maxFeePerGas?(a.accessList=t.accessList,a.maxFeePerGas=t.maxFeePerGas,a.maxPriorityFeePerGas=t.maxPriorityFeePerGas,a.type=2):(a.gasPrice=t.gasPrice,a.type=0);const{signedTransaction:n}=await e.call({procedureName:"signTransaction",params:{transaction:a,chainId:t.chainId,rpcEndpoint:"https://".concat(t.chainId,".rpc.thirdweb.com")}});return n},a=this.client;return{address:t,async signTransaction(e){if(!e.chainId)throw new Error("chainId required in tx to sign");return i({...e,chainId:e.chainId})},async sendTransaction(e){const t=(0,f.getRpcClient)({client:a,chain:(0,v.Q4)(e.chainId)}),n=await i(e);return{transactionHash:await async function(e,t){return await e({method:"eth_sendRawTransaction",params:[t]})}(t,n)}},async signMessage(t){let{message:i}=t;const a="string"===typeof i?i:i.raw,{signedMessage:n}=await e.call({procedureName:"signMessage",params:{message:a,chainId:1}});return n},async signTypedData(t){var i,a;const n=(0,L.y)(t);null!==(i=n.types)&&void 0!==i&&i.EIP712Domain&&(n.types.EIP712Domain=void 0);const r=Number((null===(a=n.domain)||void 0===a?void 0:a.chainId)||1),{signedTypedData:o}=await e.call({procedureName:"signTypedDataV4",params:{domain:n.domain,types:n.types,message:n.message,chainId:r,rpcEndpoint:"https://".concat(r,".rpc.thirdweb.com")}});return o}}}}class O{isClientIdLegacyPaper(e){return e.indexOf("-")>0&&36===e.length}constructor(e){let{client:t,onAuthSuccess:i}=e;if(Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"querier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wallet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isClientIdLegacyPaper(t.clientId))throw new Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");const n=(0,a.Wg)("inAppWallet");this.client=t,this.querier=new h({clientId:t.clientId,baseUrl:n}),this.wallet=new I({client:t,querier:this.querier}),this.auth=new y({client:t,querier:this.querier,baseUrl:n,onAuthSuccess:async e=>(null===i||void 0===i||i(e),await this.wallet.postWalletSetUp({...e.walletDetails,walletUserId:e.storedToken.authDetails.userWalletId}),await this.querier.call({procedureName:"initIframe",params:{deviceShareStored:e.walletDetails.deviceShareStored,clientId:this.client.clientId,walletUserId:e.storedToken.authDetails.userWalletId,authCookie:e.storedToken.cookieString}}),{user:{status:r.P1.LOGGED_IN_WALLET_INITIALIZED,authDetails:e.storedToken.authDetails,account:await this.wallet.getAccount(),walletAddress:e.walletDetails.walletAddress}})})}async getUser(){return this.wallet.getUserWalletStatus()}getAccount(){return this.wallet.getAccount()}async preAuthenticate(e){const t=e.strategy;switch(t){case"email":return this.auth.sendEmailLoginOtp({email:e.email});case"phone":return this.auth.sendSmsLoginOtp({phoneNumber:e.phoneNumber});default:E(t,"Provider: ".concat(t," doesnt require pre-authentication"))}}async authenticate(e){const t=e.strategy;switch(t){case"email":return await this.auth.verifyEmailLoginOtp({email:e.email,otp:e.verificationCode});case"phone":return await this.auth.verifySmsLoginOtp({otp:e.verificationCode,phoneNumber:e.phoneNumber});case"apple":case"facebook":case"google":{const i=n.B9[t];return this.auth.loginWithOauth({oauthProvider:i,closeOpenedWindow:e.closeOpenedWindow,openedWindow:e.openedWindow})}case"jwt":return this.auth.loginWithCustomJwt({jwt:e.jwt,encryptionKey:e.encryptionKey});case"auth_endpoint":return this.auth.loginWithCustomAuthEndpoint({payload:e.payload,encryptionKey:e.encryptionKey});case"iframe_email_verification":return this.auth.loginWithEmailOtp({email:e.email});case"iframe":return this.auth.loginWithModal();case"passkey":{if("sign-up"===e.type){const t=await(0,b.eA)({client:e.client,authenticatorType:e.authenticatorType,username:e.passkeyName});return this.auth.loginWithAuthToken(t)}const t=await(0,b.ip)({client:e.client,authenticatorType:e.authenticatorType});return this.auth.loginWithAuthToken(t)}default:E(t)}}async logout(){return await this.auth.logout()}}function E(e,t){throw new Error(null!==t&&void 0!==t?t:"Invalid param: ".concat(e))}}}]);
//# sourceMappingURL=1832.f42a234b.chunk.js.map