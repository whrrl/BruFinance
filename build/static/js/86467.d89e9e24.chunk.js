"use strict";(self.webpackChunkbru_finance=self.webpackChunkbru_finance||[]).push([[86467],{93300:(t,e,n)=>{n.d(e,{y:()=>i});var a=n(97779),r=n(3340);function i(t){const e=t.domain;return void 0!==(null===e||void 0===e?void 0:e.chainId)&&(0,a.q)(e.chainId)&&(t.domain={...t.domain,chainId:(0,r.ME)(t.domain.chainId)}),t}},86467:(t,e,n)=>{n.r(e),n.d(e,{connectSmartWallet:()=>vt,disconnectSmartWallet:()=>ht,isSmartWallet:()=>yt,personalAccountToSmartAccountMap:()=>mt});var a=n(34316),r=n(9893),i=n(38736),s=n(77378),o=n(72364),c=n(3340);function u(t){if(["string","number"].includes(typeof t)&&!Number.isInteger(Number(t)))throw new Error("Expected value to be an integer to convert to a bigint, got ".concat(t," of type ").concat(typeof t));return t instanceof Uint8Array?BigInt((0,c.EY)(t)):BigInt(t)}var d=n(46325),p=n(79002),l=n(77300);const y=50000n,m=t=>{const e=function(t){const{gas:e,nonce:n,to:a,from:r,value:i,maxFeePerGas:s,maxPriorityFeePerGas:o,paymaster:c,paymasterInput:u,gasPerPubdata:d,data:p}=t;return{txType:113n,from:BigInt(r),to:a?BigInt(a):0n,gasLimit:null!==e&&void 0!==e?e:0n,gasPerPubdataByteLimit:null!==d&&void 0!==d?d:y,maxFeePerGas:null!==s&&void 0!==s?s:0n,maxPriorityFeePerGas:null!==o&&void 0!==o?o:0n,paymaster:c?BigInt(c):0n,nonce:n?BigInt(n):0n,value:null!==i&&void 0!==i?i:0n,data:p||"0x0",factoryDeps:[],paymasterInput:u||"0x"}}(t);return{domain:{name:"zkSync",version:"2",chainId:t.chainId},types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]},primaryType:"Transaction",message:e}};async function f(t){const{account:e,eip712Transaction:n,chainId:a}=t,r=m(n),i=await e.signTypedData({...r});return function(t){const{chainId:e,gas:n,nonce:a,to:r,from:i,value:o,maxFeePerGas:u,maxPriorityFeePerGas:d,customSignature:p,factoryDeps:l,paymaster:m,paymasterInput:f,gasPerPubdata:v,data:h}=t,g=[a?(0,c.nj)(a):"0x",d?(0,c.nj)(d):"0x",u?(0,c.nj)(u):"0x",n?(0,c.nj)(n):"0x",null!==r&&void 0!==r?r:"0x",o?(0,c.nj)(o):"0x",null!==h&&void 0!==h?h:"0x0",(0,c.nj)(e),(0,c.nj)(""),(0,c.nj)(""),(0,c.nj)(e),null!==i&&void 0!==i?i:"0x",v?(0,c.nj)(v):(0,c.nj)(y),null!==l&&void 0!==l?l:[],null!==p&&void 0!==p?p:"0x",m&&f?[m,f]:[]];return w=["0x71",(0,s.EQ)(g)],"0x".concat(w.reduce(((t,e)=>t+e.replace("0x","")),""));var w}({...n,chainId:a,customSignature:i})}async function v(t){const{account:e,transaction:n}=t;let[a,r,i,s,y,m,f]=await Promise.all([(0,p.encode)(n),(0,d.r)(n.to),(0,d.r)(n.value),(0,d.r)(n.gas),(0,d.r)(n.maxFeePerGas),(0,d.r)(n.maxPriorityFeePerGas),(0,d.r)(n.eip712).then((t=>null===t||void 0===t?void 0:t.gasPerPubdata))]);if(!s||!y||!m){const t=(0,o.getRpcClient)(n),d=await t({method:"zks_estimateFee",params:[{from:e.address,to:r,data:a,value:i?(0,c.cK)(i):void 0}]});s=u(d.gas_limit);y=2n*u(d.max_fee_per_gas),m=u(d.max_priority_fee_per_gas)||1n,f=u(d.gas_per_pubdata_limit)}return{...await(0,l.$)({transaction:{...n,gas:s,maxFeePerGas:y,maxPriorityFeePerGas:m},from:e.address}),...n.eip712,gasPerPubdata:f,from:e.address}}var h=n(93300),g=n(80884),w=n(97965),b=n(22017),x=n(43687);const P=x.k;var G=n(99577),A=n(63206),I=n(59052);const T="/docs/contract/decodeEventLog";function O(t){let{param:e,value:n}=t;if("string"===e.type||"bytes"===e.type||"tuple"===e.type||e.type.match(/^(.*)\[(\d+)?\]$/))return n;return((0,A.n)([e],n)||[])[0]}function E(t){let{abi:e,eventName:n,logs:a,strict:r=!0}=t;return a.map((t=>{try{const a=function(t){const{abi:e,data:n,strict:a,topics:r}=t,i=null===a||void 0===a||a,[s,...o]=r;if(!s)throw new w._z({docsPath:T});const c=e.find((t=>"event"===t.type&&s===P((0,I.B)(t))));if(!c||!("name"in c)||"event"!==c.type)throw new w.kE(s,{docsPath:T});const{name:u,inputs:d}=c,p=null===d||void 0===d?void 0:d.some((t=>!("name"in t&&t.name)));let l=p?[]:{};const y=d.filter((t=>"indexed"in t&&t.indexed));for(let v=0;v<y.length;v++){const t=y[v],e=o[v];if(!e)throw new w.l3({abiItem:c,param:t});l[p?v:t.name||v]=O({param:t,value:e})}const m=d.filter((t=>!("indexed"in t&&t.indexed)));if(m.length>0)if(n&&"0x"!==n)try{const t=(0,A.n)(m,n);if(t)if(p)l=[...l,...t];else for(let e=0;e<m.length;e++)l[m[e].name]=t[e]}catch(f){if(i){if(f instanceof w.Iy||f instanceof G.SK)throw new w.fo({abiItem:c,data:n,params:m,size:(0,b.E)(n)});throw f}}else if(i)throw new w.fo({abiItem:c,data:"0x",params:m,size:0});return{eventName:u,args:Object.values(l).length>0?l:void 0}}({...t,abi:e,strict:r});return n&&!n.includes(a.eventName)?null:{...a,...t}}catch(i){let e,n;if(i instanceof w.kE)return null;if(i instanceof w.fo||i instanceof w.l3){var a;if(r)return null;e=i.abiItem.name,n=null===(a=i.abiItem.inputs)||void 0===a?void 0:a.some((t=>!("name"in t&&t.name)))}return{...t,args:n?[]:{},eventName:e}}})).filter(Boolean)}var C=n(55907),S=n(11370);class D extends S.C{constructor(t){super('Filter type "'.concat(t,'" is not supported.')),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"FilterTypeNotSupportedError"})}}var B=n(37131),L=n(81064),k=n(31376),U=n(31499),M=n(74074),j=n(73924);function F(t,e){const n=typeof t,a=e.type;switch(a){case"address":return(0,M.P)(t,{strict:!1});case"bool":return"boolean"===n;case"function":case"string":return"string"===n;default:return"tuple"===a&&"components"in e?Object.values(e.components).every(((e,n)=>F(Object.values(t)[n],e))):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(a)?"number"===n||"bigint"===n:/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(a)?"string"===n||t instanceof Uint8Array:!!/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(a)&&(Array.isArray(t)&&t.every((t=>F(t,{...e,type:a.replace(/(\[[0-9]{0,}\])$/,"")}))))}}function _(t,e,n){for(const a in t){const r=t[a],i=e[a];if("tuple"===r.type&&"tuple"===i.type&&"components"in r&&"components"in i)return _(r.components,i.components,n[a]);const s=[r.type,i.type];if(!(!s.includes("address")||!s.includes("bytes20"))||(s.includes("address")&&s.includes("string")||!(!s.includes("address")||!s.includes("bytes")))&&(0,M.P)(n[a],{strict:!1}))return s}}const H="/docs/contract/encodeEventTopics";function N(t){const{abi:e,eventName:n,args:a}=t;let r=e[0];if(n){const t=function(t){const{abi:e,args:n=[],name:a}=t,r=(0,U.q)(a,{strict:!1}),i=e.filter((t=>r?"function"===t.type?(0,j.V)(t)===a:"event"===t.type&&P(t)===a:"name"in t&&t.name===a));if(0===i.length)return;if(1===i.length)return i[0];let s;for(const o of i)if("inputs"in o)if(n&&0!==n.length){if(o.inputs&&0!==o.inputs.length&&o.inputs.length===n.length&&n.every(((t,e)=>{const n="inputs"in o&&o.inputs[e];return!!n&&F(t,n)}))){if(s&&"inputs"in s&&s.inputs){const t=_(o.inputs,s.inputs,n);if(t)throw new w.nM({abiItem:o,type:t[0]},{abiItem:s,type:t[1]})}s=o}}else if(!o.inputs||0===o.inputs.length)return o;return s||i[0]}({abi:e,name:n});if(!t)throw new w.M_(n,{docsPath:H});r=t}if("event"!==r.type)throw new w.M_(void 0,{docsPath:H});const i=(0,I.B)(r),s=P(i);let o=[];if(a&&"inputs"in r){var c,u;const t=null===(c=r.inputs)||void 0===c?void 0:c.filter((t=>"indexed"in t&&t.indexed)),e=Array.isArray(a)?a:Object.values(a).length>0&&null!==(u=null===t||void 0===t?void 0:t.map((t=>a[t.name])))&&void 0!==u?u:[];var d;if(e.length>0)o=null!==(d=null===t||void 0===t?void 0:t.map(((t,n)=>Array.isArray(e[n])?e[n].map(((a,r)=>z({param:t,value:e[n][r]}))):e[n]?z({param:t,value:e[n]}):null)))&&void 0!==d?d:[]}return[s,...o]}function z(t){let{param:e,value:n}=t;if("string"===e.type||"bytes"===e.type)return(0,L.S)((0,B.ZJ)(n));if("tuple"===e.type||e.type.match(/^(.*)\[(\d+)?\]$/))throw new D(e.type);return(0,k.h)([e],[n])}function V(){return function(t){const{signature:e}=t;let n;var a;return n=(a=e)&&"object"===typeof a&&"type"in a&&"event"===a.type?e:(0,C.$)(e),{abiEvent:n,hash:(0,x.k)(n),topics:N({abi:[n],args:t.filters})}}({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}})}var $=n(49703),W=n(77717),K=n(20635),R=n(52620);const Z=(0,r.xH)({id:300,name:"ZkSync Sepolia",nativeCurrency:{decimals:18,name:"Ether",symbol:"ETH"},blockExplorers:[{name:"zkSync Sepolia Block Explorer",url:"https://sepolia.explorer.zksync.io",apiUrl:"https://block-explorer-api.sepolia.zksync.dev/api"}]}),q=(0,r.xH)({id:324,name:"ZkSync Era",nativeCurrency:{decimals:18,name:"Ether",symbol:"ETH"},blockExplorers:[{name:"zkSync Era Block Explorer",url:"https://explorer.zksync.io",apiUrl:"https://block-explorer-api.zksync.dev/api"}]});var J=n(97779);const Q=()=>{const t=BigInt(Math.floor(4294967296*Math.random())),e=BigInt(Math.floor(4294967296*Math.random())),n=BigInt(Math.floor(4294967296*Math.random())),a=BigInt(Math.floor(4294967296*Math.random())),r=BigInt(Math.floor(4294967296*Math.random())),i=BigInt(Math.floor(4294967296*Math.random()));return t<<BigInt(160)|e<<BigInt(128)|n<<BigInt(96)|a<<BigInt(64)|r<<BigInt(32)|i},Y=()=>BigInt((0,R.xW)([(0,c.cK)(Q()),"0x0000000000000000"]));function X(t){return Object.fromEntries(Object.entries(t).map((t=>{let[e,n]=t;return[e,(0,J.q)(n)?n:(0,c.nj)(n)]})))}async function tt(t){var e,n;const a=await nt({...t,operation:"eth_estimateUserOperationGas",params:[X(t.userOp),null!==(e=null===(n=t.options.overrides)||void 0===n?void 0:n.entrypointAddress)&&void 0!==e?e:K.uh]});return{preVerificationGas:(0,c.uU)(a.preVerificationGas),verificationGas:(0,c.uU)(a.verificationGas),verificationGasLimit:(0,c.uU)(a.verificationGasLimit),callGasLimit:(0,c.uU)(a.callGasLimit)+K.L8}}async function et(t){const e=await nt({...t,operation:"eth_getUserOperationReceipt",params:[t.userOpHash]});if(e){if(!1===e.success){var n;const t=null===(n=function(t){const{logs:e,events:n,strict:a}=t;return E({logs:e,abi:n.map((t=>t.abiEvent)),strict:a})}({events:[V()],logs:e.logs})[0])||void 0===n||null===(n=n.args)||void 0===n?void 0:n.revertReason;if(!t)throw new Error("UserOp failed at txHash: ".concat(e.transactionHash));const a=(0,g.W)({data:t});throw new Error("UserOp failed with reason: '".concat(a.args.join(","),"' at txHash: ").concat(e.transactionHash))}return e.receipt}}async function nt(t){var e,n;const{options:a,operation:r,params:i}=t;K.Oi&&console.debug(">>> sending ".concat(r," with payload:"),i);const s=null!==(e=null===(n=a.overrides)||void 0===n?void 0:n.bundlerUrl)&&void 0!==e?e:(0,K.RZ)(a.chain),o=(0,$.KI)(a.client),c=await o(s,{method:"POST",headers:{"Content-Type":"application/json"},body:(0,W.A)({jsonrpc:"2.0",id:1,method:r,params:i})}),u=await c.json();if(!c.ok||u.error){let t=u.error||c.statusText;"object"===typeof t&&(t=JSON.stringify(t));const e=u.code||"UNKNOWN";throw new Error("".concat(r," error: ").concat(t,"\nStatus: ").concat(c.status,"\nCode: ").concat(e))}return K.Oi&&console.debug("<<< ".concat(r," result:"),u),u.result}var at=n(77877),rt=n(86511);var it=n(22561),st=n(28482),ot=n(69961),ct=n(42002),ut=n(24793);async function dt(t){var e,n,a,r;const{userOp:i,options:s}=t;var o;if(null!==(e=s.overrides)&&void 0!==e&&e.paymaster)return null===(o=s.overrides)||void 0===o?void 0:o.paymaster(i);const u=s.client,d=(0,K.lI)(s.chain),p=null!==(n=null===(a=s.overrides)||void 0===a?void 0:a.entrypointAddress)&&void 0!==n?n:K.uh,l=(0,$.KI)(u),y=await l(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[X(i),p]})}),m=await y.json();if(!y.ok){const t=m.error||y.statusText,e=m.code||"UNKNOWN";throw new Error("Paymaster error: ".concat(t,"\nStatus: ").concat(y.status,"\nCode: ").concat(e))}if(K.Oi&&console.debug("Paymaster result:",m),m.result)return"string"===typeof m.result?{paymasterAndData:m.result}:{paymasterAndData:m.result.paymasterAndData,verificationGasLimit:m.result.verificationGasLimit?(0,c.uU)(m.result.verificationGasLimit):void 0,preVerificationGas:m.result.preVerificationGas?(0,c.uU)(m.result.preVerificationGas):void 0,callGasLimit:m.result.callGasLimit?(0,c.uU)(m.result.callGasLimit):void 0};const f=(null===(r=m.error)||void 0===r?void 0:r.message)||m.error||y.statusText||"unknown error";throw new Error("Paymaster error from ".concat(d,": ").concat(f))}async function pt(t){var e,n;const{executeTx:a,options:r}=t,i=await(0,ot.isContractDeployed)(r.accountContract)?"0x":await async function(t){const{factoryContract:e}=t,n=function(t){var e,n,a;const{factoryContract:r,options:i}=t;return null!==(e=i.overrides)&&void 0!==e&&e.createAccount?i.overrides.createAccount(r):(0,at.m)({contract:r,method:"function createAccount(address, bytes) returns (address)",params:[i.personalAccount.address,(0,c.i3)(null!==(n=null===(a=i.overrides)||void 0===a?void 0:a.accountSalt)&&void 0!==n?n:"")]})}({factoryContract:e,options:t});return(0,R.xW)([e.address,await(0,p.encode)(n)])}(r),s=await(0,p.encode)(a);let{maxFeePerGas:o,maxPriorityFeePerGas:u}=a;const l=null!==(e=null===(n=r.overrides)||void 0===n?void 0:n.bundlerUrl)&&void 0!==e?e:(0,K.RZ)(r.chain);if((0,$.Lj)(l)){const t=await async function(t){const e=await nt({...t,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:(0,c.uU)(e.maxPriorityFeePerGas),maxFeePerGas:(0,c.uU)(e.maxFeePerGas)}}({options:r});o=t.maxFeePerGas,u=t.maxPriorityFeePerGas}else{const[t,e]=await Promise.all([(0,d.r)(o),(0,d.r)(u)]);if(t&&e)o=t,u=e;else{var y,m;const n=await(0,it.G)(r.client,r.chain);u=null!==(y=null!==e&&void 0!==e?e:n.maxPriorityFeePerGas)&&void 0!==y?y:0n,o=null!==(m=null!==t&&void 0!==t?t:n.maxFeePerGas)&&void 0!==m?m:0n}}const f=Y(),v={sender:r.accountContract.address,nonce:f,initCode:i,callData:s,maxFeePerGas:o,maxPriorityFeePerGas:u,callGasLimit:0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:K.km};if(r.sponsorGas){const t=await dt({userOp:v,options:r}),e=t.paymasterAndData;if(e&&"0x"!==e&&(v.paymasterAndData=e),t.callGasLimit&&t.verificationGasLimit&&t.preVerificationGas)v.callGasLimit=t.callGasLimit,v.verificationGasLimit=t.verificationGasLimit,v.preVerificationGas=t.preVerificationGas;else{const t=await tt({userOp:v,options:r});if(v.callGasLimit=t.callGasLimit,v.verificationGasLimit=t.verificationGasLimit,v.preVerificationGas=t.preVerificationGas,e&&"0x"!==e){const t=await dt({userOp:v,options:r});t.paymasterAndData&&"0x"!==t.paymasterAndData&&(v.paymasterAndData=t.paymasterAndData)}}}else{const t=await tt({userOp:v,options:r});v.callGasLimit=t.callGasLimit,v.verificationGasLimit=t.verificationGasLimit,v.preVerificationGas=t.preVerificationGas}return{...v,signature:"0x"}}async function lt(t){var e;const{userOp:n,options:a}=t,r=function(t){const{userOp:e,entryPoint:n,chainId:a}=t,r=(0,ut.S)(e.initCode),i=(0,ut.S)(e.callData),s=(0,ut.S)(e.paymasterAndData),o=(0,st.encodeAbiParameters)([{type:"address"},{type:"uint256"},{type:"bytes32"},{type:"bytes32"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"bytes32"}],[e.sender,e.nonce,r,i,e.callGasLimit,e.verificationGasLimit,e.preVerificationGas,e.maxFeePerGas,e.maxPriorityFeePerGas,s]),c=(0,st.encodeAbiParameters)([{type:"bytes32"},{type:"address"},{type:"uint256"}],[(0,ut.S)(o),n,BigInt(a)]);return(0,ut.S)(c)}({userOp:n,entryPoint:(null===(e=a.overrides)||void 0===e?void 0:e.entrypointAddress)||K.uh,chainId:a.chain.id});if(a.personalAccount.signMessage){const t=await a.personalAccount.signMessage({message:{raw:(0,ct.aT)(r)}});return{...n,signature:t}}throw new Error("signMessage not implemented in signingAccount")}function yt(t){return"smart"===t.id}const mt=new WeakMap,ft=new WeakMap;async function vt(t,e,r){var s;const{personalAccount:o,client:u,chain:d}=e;if(!o)throw new Error("Personal wallet does not have an account");const p=r,l=null!==(s=p.factoryAddress)&&void 0!==s?s:K.zk,y=null!==d&&void 0!==d?d:p.chain,m="gasless"in p?p.gasless:p.sponsorGas;if(function(t){return t.id===q.id||t.id===Z.id}(y))return[gt({creationOptions:r,connectionOptions:e,chain:y,sponsorGas:m}),y];const f=(0,i.P)({client:u,address:l,chain:y}),v=await async function(t,e){var n,a,r,i;if(null!==(n=e.overrides)&&void 0!==n&&n.predictAddress)return e.overrides.predictAddress(t);if(null!==(a=e.overrides)&&void 0!==a&&a.accountAddress)return e.overrides.accountAddress;const s=e.personalAccountAddress;if(!s)throw new Error("Account address is required to predict the smart wallet address.");const o=(0,c.i3)(null!==(r=null===(i=e.overrides)||void 0===i?void 0:i.accountSalt)&&void 0!==r?r:"");return(0,rt.readContract)({contract:t,method:"function getAddress(address, bytes) returns (address)",params:[s,o]})}(f,{personalAccountAddress:o.address,...p}).then((t=>t)).catch((t=>{throw new Error("Failed to get account address with factory contract ".concat(f.address," on chain ID ").concat(y.id,". Are you on the right chain?"),{cause:t})})),g=(0,i.P)({client:u,address:v,chain:y}),w=await async function(t){const{accountContract:e}=t,r={address:e.address,async sendTransaction(n){const a=function(t){var e;const{accountContract:n,options:a,transaction:r}=t;return null!==(e=a.overrides)&&void 0!==e&&e.execute?a.overrides.execute(n,r):(0,at.m)({contract:n,method:"function execute(address, uint256, bytes)",params:[r.to||"",r.value||0n,r.data||"0x"]})}({accountContract:e,options:t,transaction:n});return bt({executeTx:a,options:t})},async sendBatchTransaction(n){const a=function(t){var e;const{accountContract:n,options:a,transactions:r}=t;return null!==(e=a.overrides)&&void 0!==e&&e.executeBatch?a.overrides.executeBatch(n,r):(0,at.m)({contract:n,method:"function executeBatch(address[], uint256[], bytes[])",params:[r.map((t=>t.to||"")),r.map((t=>t.value||0n)),r.map((t=>t.data||"0x"))]})}({accountContract:e,options:t,transactions:n});return bt({executeTx:a,options:t})},async signMessage(a){let{message:i}=a;const[{isContractDeployed:s},{readContract:o},{encodeAbiParameters:c},{hashMessage:u},{checkContractWalletSignature:d}]=await Promise.all([Promise.resolve().then(n.bind(n,69961)),Promise.resolve().then(n.bind(n,86511)),Promise.resolve().then(n.bind(n,28482)),n.e(67143).then(n.bind(n,67143)),n.e(89547).then(n.bind(n,89547))]);await s(e)||(console.log("Account contract not deployed yet. Deploying account before signing message"),await wt({options:t,account:r,accountContract:e}));const p=u(i);let l,y=!1;try{await o({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[p]}),y=!0}catch(m){}if(y){const n=c([{type:"bytes32"}],[p]);l=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:n}})}else l=await t.personalAccount.signMessage({message:i});if(await d({contract:e,message:i,signature:l}))return l;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async signTypedData(i){var s,o;const c=(0,h.y)(i),[{isContractDeployed:u},{readContract:d},{encodeAbiParameters:p},{checkContractWalletSignedTypedData:l}]=await Promise.all([Promise.resolve().then(n.bind(n,69961)),Promise.resolve().then(n.bind(n,86511)),Promise.resolve().then(n.bind(n,28482)),n.e(48143).then(n.bind(n,48143))]);if((null===(s=c.domain)||void 0===s||null===(s=s.verifyingContract)||void 0===s?void 0:s.toLowerCase())===(null===(o=e.address)||void 0===o?void 0:o.toLowerCase()))return t.personalAccount.signTypedData(c);await u(e)||(console.log("Account contract not deployed yet. Deploying account before signing message"),await wt({options:t,account:r,accountContract:e}));const y=(0,a.Z)(c);let m,f=!1;try{await d({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[y]}),f=!0}catch(v){}if(f){const n=p([{type:"bytes32"}],[y]);m=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:n}})}else m=await t.personalAccount.signTypedData(c);if(await l({contract:e,data:c,signature:m}))return m;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")}};return r}({...p,chain:y,sponsorGas:m,personalAccount:o,accountContract:g,factoryContract:f,client:u});return mt.set(o,t),ft.set(t,o),[w,y]}async function ht(t){const e=ft.get(t);e&&(mt.delete(e),ft.delete(t))}function gt(t){const{creationOptions:e,connectionOptions:n,chain:a}=t,i={address:n.personalAccount.address,async sendTransaction(s){var o,c;const u={data:s.data,to:null!==(o=s.to)&&void 0!==o?o:void 0,value:null!==(c=s.value)&&void 0!==c?c:0n,chain:(0,r.Q4)(s.chainId),client:n.client};let d=await v({account:i,transaction:u});if(t.sponsorGas){const t=await async function(t){const e=await nt({options:t.options,operation:"zk_paymasterData",params:[t.transaction]});return{paymaster:e.paymaster,paymasterInput:e.paymasterInput}}({options:{client:n.client,overrides:e.overrides,chain:a},transaction:d});d={...d,...t}}const p=await f({account:i,chainId:a.id,eip712Transaction:d}),l=await async function(t){return{transactionHash:(await nt({options:t.options,operation:"zk_broadcastTransaction",params:[{...t.transaction,signedTransaction:t.signedTransaction}]})).transactionHash}}({options:{client:n.client,overrides:e.overrides,chain:a},transaction:d,signedTransaction:p});return{transactionHash:l.transactionHash,client:n.client,chain:a}},async signMessage(t){let{message:e}=t;return n.personalAccount.signMessage({message:e})},async signTypedData(t){const e=(0,h.y)(t);return n.personalAccount.signTypedData(e)}};return i}async function wt(t){const{options:e,account:a,accountContract:r}=t,[{sendTransaction:i},{prepareTransaction:s}]=await Promise.all([Promise.resolve().then(n.bind(n,96223)),Promise.resolve().then(n.bind(n,21300))]),o=s({client:e.client,chain:e.chain,to:r.address,value:0n,gas:50000n});return await i({transaction:o,account:a})}async function bt(t){const{executeTx:e,options:n}=t,a=await pt({executeTx:e,options:n}),r=await lt({options:n,userOp:a}),i=await async function(t){var e,n;return nt({...t,operation:"eth_sendUserOperation",params:[X(t.userOp),null!==(e=null===(n=t.options.overrides)||void 0===n?void 0:n.entrypointAddress)&&void 0!==e?e:K.uh]})}({options:n,userOp:r}),s=await async function(t){const{options:e,userOpHash:n}=t,a=12e4,r=1e3,i=Date.now()+a;for(;Date.now()<i;){const t=await et({options:e,userOpHash:n});if(t)return t;await new Promise((t=>setTimeout(t,r)))}throw new Error("Timeout waiting for userOp to be mined")}({options:n,userOpHash:i});return{client:n.client,chain:n.chain,transactionHash:s.transactionHash}}},77378:(t,e,n)=>{n.d(e,{EQ:()=>o});var a=n(11370),r=n(30751),i=n(37131),s=n(84117);function o(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hex";const n=c(t),a=(0,r.l)(new Uint8Array(n.length));return n.encode(a),"hex"===e?(0,s.My)(a.bytes):a.bytes}function c(t){return Array.isArray(t)?function(t){const e=t.reduce(((t,e)=>t+e.length),0),n=u(e);return{length:e<=55?1+e:1+n+e,encode(a){e<=55?a.pushByte(192+e):(a.pushByte(247+n),1===n?a.pushUint8(e):2===n?a.pushUint16(e):3===n?a.pushUint24(e):a.pushUint32(e));for(const{encode:e}of t)e(a)}}}(t.map((t=>c(t)))):function(t){const e="string"===typeof t?(0,i.aT)(t):t,n=u(e.length),a=1===e.length&&e[0]<128?1:e.length<=55?1+e.length:1+n+e.length;return{length:a,encode(t){1===e.length&&e[0]<128?t.pushBytes(e):e.length<=55?(t.pushByte(128+e.length),t.pushBytes(e)):(t.pushByte(183+n),1===n?t.pushUint8(e.length):2===n?t.pushUint16(e.length):3===n?t.pushUint24(e.length):t.pushUint32(e.length),t.pushBytes(e))}}}(t)}function u(t){if(t<256)return 1;if(t<65536)return 2;if(t<2**24)return 3;if(t<2**32)return 4;throw new a.C("Length is too large.")}},34316:(t,e,n)=>{n.d(e,{Z:()=>c});var a=n(31376),r=n(52620),i=n(84117),s=n(81064),o=n(33998);function c(t){const{domain:e={},message:n,primaryType:a}=t,i={EIP712Domain:(0,o.H4)({domain:e}),...t.types};(0,o.$$)({domain:e,message:n,primaryType:a,types:i});const c=["0x1901"];return e&&c.push(function(t){let{domain:e,types:n}=t;return u({data:e,primaryType:"EIP712Domain",types:n})}({domain:e,types:i})),"EIP712Domain"!==a&&c.push(u({data:n,primaryType:a,types:i})),(0,s.S)((0,r.xW)(c))}function u(t){let{data:e,primaryType:n,types:a}=t;const r=d({data:e,primaryType:n,types:a});return(0,s.S)(r)}function d(t){let{data:e,primaryType:n,types:r}=t;const i=[{type:"bytes32"}],s=[p({primaryType:n,types:r})];for(const a of r[n]){const[t,n]=y({types:r,name:a.name,type:a.type,value:e[a.name]});i.push(t),s.push(n)}return(0,a.h)(i,s)}function p(t){let{primaryType:e,types:n}=t;const a=(0,i.nj)(function(t){let{primaryType:e,types:n}=t,a="";const r=l({primaryType:e,types:n});r.delete(e);const i=[e,...Array.from(r).sort()];for(const s of i)a+="".concat(s,"(").concat(n[s].map((t=>{let{name:e,type:n}=t;return"".concat(n," ").concat(e)})).join(","),")");return a}({primaryType:e,types:n}));return(0,s.S)(a)}function l(t){let{primaryType:e,types:n}=t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;const r=e.match(/^\w*/u),i=null===r||void 0===r?void 0:r[0];if(a.has(i)||void 0===n[i])return a;a.add(i);for(const s of n[i])l({primaryType:s.type,types:n},a);return a}function y(t){let{types:e,name:n,type:r,value:o}=t;if(void 0!==e[r])return[{type:"bytes32"},(0,s.S)(d({data:o,primaryType:r,types:e}))];if("bytes"===r){const t=o.length%2?"0":"";return o="0x".concat(t+o.slice(2)),[{type:"bytes32"},(0,s.S)(o)]}if("string"===r)return[{type:"bytes32"},(0,s.S)((0,i.nj)(o))];if(r.lastIndexOf("]")===r.length-1){const t=r.slice(0,r.lastIndexOf("[")),i=o.map((a=>y({name:n,type:t,types:e,value:a})));return[{type:"bytes32"},(0,s.S)((0,a.h)(i.map((t=>{let[e]=t;return e})),i.map((t=>{let[,e]=t;return e}))))]}return[{type:r},o]}},33998:(t,e,n)=>{n.d(e,{H4:()=>p,$$:()=>d});var a=n(97965),r=n(25872),i=n(74074),s=n(22017),o=n(84117);const c=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,u=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function d(t){const{domain:e,message:n,primaryType:d,types:p}=t,l=(t,e)=>{for(const n of t){const{name:t,type:d}=n,y=e[t],m=d.match(u);if(m&&("number"===typeof y||"bigint"===typeof y)){const[t,e,n]=m;(0,o.cK)(y,{signed:"int"===e,size:Number.parseInt(n)/8})}if("address"===d&&"string"===typeof y&&!(0,i.P)(y))throw new r.M({address:y});const f=d.match(c);if(f){const[t,e]=f;if(e&&(0,s.E)(y)!==Number.parseInt(e))throw new a.BI({expectedSize:Number.parseInt(e),givenSize:(0,s.E)(y)})}const v=p[d];v&&l(v,y)}};if(p.EIP712Domain&&e&&l(p.EIP712Domain,e),"EIP712Domain"!==d){const t=p[d];l(t,n)}}function p(t){let{domain:e}=t;return["string"===typeof(null===e||void 0===e?void 0:e.name)&&{name:"name",type:"string"},(null===e||void 0===e?void 0:e.version)&&{name:"version",type:"string"},"number"===typeof(null===e||void 0===e?void 0:e.chainId)&&{name:"chainId",type:"uint256"},(null===e||void 0===e?void 0:e.verifyingContract)&&{name:"verifyingContract",type:"address"},(null===e||void 0===e?void 0:e.salt)&&{name:"salt",type:"bytes32"}].filter(Boolean)}}}]);
//# sourceMappingURL=86467.d89e9e24.chunk.js.map